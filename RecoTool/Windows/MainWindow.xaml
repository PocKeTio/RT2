<Window x:Class="RecoTool.Windows.MainWindow"
        x:Name="MainWin"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RecoTool.Windows"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        mc:Ignorable="d"
        Title="RecoTool" Height="900" Width="1600" WindowStartupLocation="CenterScreen" WindowStyle="None" 
        AllowsTransparency="True" ResizeMode="CanResizeWithGrip" Background="Transparent">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <!-- Shadows -->
        <DropShadowEffect x:Key="WindowShadow" BlurRadius="20" ShadowDepth="0" Direction="0" Color="#44000000" Opacity="0.5"/>
        <DropShadowEffect x:Key="LightShadow" BlurRadius="8" ShadowDepth="1" Direction="315" Color="#22000000" Opacity="0.3"/>
        <!-- Premium gradient for header -->
        <LinearGradientBrush x:Key="BNPHeaderGradient" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#0A7E60" Offset="0"/>
            <GradientStop Color="#006A4D" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- Style for window control buttons -->
        <Style x:Key="WindowControlButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#22FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#44FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Style for navigation buttons in header -->
        <Style x:Key="HeaderNavigationButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Height" Value="44"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#33FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#55FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Style for close button with red hover -->
        <Style x:Key="CloseButtonStyle" BasedOn="{StaticResource WindowControlButton}" TargetType="Button">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E81123"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Style for modern ribbon buttons -->
        <Style x:Key="RibbonButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource BNPHoverBackground}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#E0F2F1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Style for modern ComboBox -->
        <Style x:Key="ModernComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="BorderBrush" Value="{StaticResource BNPBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="Height" Value="32"/>
        </Style>
    </Window.Resources>
    
    <Border CornerRadius="8" Effect="{StaticResource WindowShadow}" Background="{DynamicResource BNPBackground}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="56"/> <!-- Header avec navigation intégrée -->
                <RowDefinition Height="*"/> <!-- Content -->
                <RowDefinition Height="22"/> <!-- Status Bar -->
            </Grid.RowDefinitions>

            <!-- Header with BNP gradient Ribbon and Window Controls -->
            <Border Grid.Row="0" Background="{StaticResource BNPHeaderGradient}" CornerRadius="8,8,0,0" Effect="{StaticResource LightShadow}" MouseLeftButtonDown="Header_MouseLeftButtonDown" BorderBrush="#26FFFFFF" BorderThickness="0,0,0,1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/> <!-- Left side with title -->
                        <ColumnDefinition Width="*"/> <!-- Center -->
                        <ColumnDefinition Width="Auto"/> <!-- Right side with controls -->
                    </Grid.ColumnDefinitions>

                    <!-- Left side - Logo only -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0,0,0">
                        <Border Background="#E8F5EE" CornerRadius="30" Width="40" Height="40" Margin="0,0,10,0">
                            <TextBlock Foreground="#006A4D" FontSize="22" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"><Run Text="R"/><Run Language="en-gb" Text="T"/></TextBlock>
                        </Border>
                    </StackPanel>

                    <!-- Center - Country Selector + Navigation Buttons -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,10,0">
                        <!-- Country Selection -->
                        <TextBlock Text="Country:" VerticalAlignment="Center" Margin="20,0,8,0" FontSize="14" Foreground="White"/>
                        <Border x:Name="CountryBorder" CornerRadius="4" BorderThickness="1" Padding="2" Margin="0,0,10,0" BorderBrush="{StaticResource BNPBorderBrush}">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedItem, ElementName=CountryComboBox}" Value="{x:Null}">
                                            <Setter Property="Background" Value="Red"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding SelectedIndex, ElementName=CountryComboBox}" Value="-1">
                                            <Setter Property="Background" Value="Red"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <ComboBox x:Name="CountryComboBox" Width="180" Height="30" 
                                      ItemsSource="{Binding AvailableCountries}" 
                                      DisplayMemberPath="DisplayName"
                                      IsEditable="False"
                                      HorizontalContentAlignment="Center" VerticalContentAlignment="Center" VerticalAlignment="Center">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox">
                                        <Setter Property="Background" Value="Transparent"/>
                                    </Style>
                                </ComboBox.Style>
                            </ComboBox>
                        </Border>
                        <!-- Separator -->
                        <Rectangle Width="1" Height="24" Fill="#4DFFFFFF" Margin="5,0"/>

                        <!-- Navigation Buttons -->
                        <Button x:Name="HomeButton" Click="HomeButton_Click" Margin="0,0,8,0" MinWidth="90">
                            <Button.Style>
                                <Style BasedOn="{StaticResource HeaderNavigationButton}" TargetType="Button">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Content, ElementName=MainContent}" Value="{x:Type local:HomePage}">
                                            <Setter Property="Background" Value="#44FFFFFF"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE10F;" FontFamily="Segoe MDL2 Assets" FontSize="18" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Home" Foreground="White" FontSize="15" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="ReconciliationButton" Click="ReconciliationButton_Click" Margin="8,0" MinWidth="130">
                            <Button.Style>
                                <Style BasedOn="{StaticResource HeaderNavigationButton}" TargetType="Button">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Content, ElementName=MainContent}" Value="{x:Type local:ReconciliationPage}">
                                            <Setter Property="Background" Value="#44FFFFFF"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE133;" FontFamily="Segoe MDL2 Assets" FontSize="18" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Reconciliation" Foreground="White" FontSize="15" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="ReportsButton" Click="ReportsButton_Click" Style="{StaticResource HeaderNavigationButton}" Margin="8,0" MinWidth="90">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE9D9;" FontFamily="Segoe MDL2 Assets" FontSize="18" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Reports" Foreground="White" FontSize="15" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="SettingsButton" Click="SettingsButton_Click" Style="{StaticResource HeaderNavigationButton}" Margin="8,0,8,0" MinWidth="90">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE713;" FontFamily="Segoe MDL2 Assets" FontSize="18" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Settings" Foreground="White" FontSize="15" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="DwingsButtonsButton" Click="DwingsButtonsButton_Click" Style="{StaticResource HeaderNavigationButton}" Margin="8,0,8,0" MinWidth="150">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8D7;" FontFamily="Segoe MDL2 Assets" FontSize="18" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="DWINGS BUTTONS" Foreground="White" FontSize="15" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="SynchronizeButton" Click="SynchronizeButton_Click" Style="{StaticResource HeaderNavigationButton}" Margin="8,0,15,0" MinWidth="120" Visibility="Collapsed">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="18" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Synchronize" Foreground="White" FontSize="15" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <!-- Network status badge -->
                        <Rectangle Width="1" Height="24" Fill="#4DFFFFFF" Margin="5,0"/>
                        <Border CornerRadius="10" Padding="10,2" Margin="8,0,0,0" Background="{Binding NetworkStatusBrush}" VerticalAlignment="Center">
                            <TextBlock Text="{Binding NetworkStatusText}" Foreground="White" FontWeight="SemiBold"/>
                        </Border>
                    </StackPanel>
                    
                    <!-- Right side - Window Controls and Brand with improved styling -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <Button x:Name="MinimizeButton" Style="{StaticResource WindowControlButton}" Click="MinimizeButton_Click">
                            <TextBlock Text="&#xE921;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                        </Button>
                        <Button x:Name="MaximizeButton" Style="{StaticResource WindowControlButton}" Click="MaximizeButton_Click">
                            <TextBlock Text="&#xE922;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                        </Button>
                        <Button x:Name="CloseButton" Style="{StaticResource CloseButtonStyle}" Click="CloseButton_Click">
                            <TextBlock Text="&#xE8BB;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content -->
            <Border Grid.Row="1" Margin="12" CornerRadius="6" Background="{DynamicResource BNPSectionBackground}" BorderBrush="{DynamicResource BNPBorderBrush}" BorderThickness="1">
                <ContentControl x:Name="MainContent" Margin="8"/>
            </Border>
            
            <!-- Barre de statut -->
            <Border Grid.Row="2" BorderBrush="#DDDDDD" BorderThickness="0,1,0,0" Background="#F5F5F5">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/> <!-- Statut général -->
                        <ColumnDefinition Width="Auto"/> <!-- Statut cache référentiel -->
                        <ColumnDefinition Width="Auto"/> <!-- Statut données opérationnelles -->
                    </Grid.ColumnDefinitions>
                    
                    <!-- Statut général d'initialisation -->
                    <TextBlock Grid.Column="0" Text="{Binding InitializationStatus}" VerticalAlignment="Center" Margin="10,0,0,0" 
                              Foreground="{Binding InitializationBrush}"/>
                    
                    <!-- Statut cache référentiel -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,15,0">
                        <TextBlock Text="Référentiel:" VerticalAlignment="Center" Margin="0,0,5,0" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding ReferentialCacheStatus}" VerticalAlignment="Center" 
                                   Foreground="{Binding ReferentialBrush}"/>
                        <TextBlock Text="[CACHE]" VerticalAlignment="Center" Margin="5,0,0,0" FontStyle="Italic"
                                   Visibility="{Binding ReferentialCacheAvailable, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </StackPanel>
                    
                    <!-- Statut données opérationnelles -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,10,0">
                        <TextBlock Text="Données opérationnelles:" VerticalAlignment="Center" Margin="0,0,5,0" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding OperationalDataStatus}" VerticalAlignment="Center"/>
                        <TextBlock Text="[OFFLINE]" VerticalAlignment="Center" Margin="5,0,0,0" FontStyle="Italic" Foreground="#FF8C00"
                                   Visibility="{Binding IsOffline, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Window Resize Grip -->
            <Thumb Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,5,5" Width="16" Height="16" Cursor="SizeNWSE" DragDelta="Thumb_DragDelta">
                <Thumb.Template>
                    <ControlTemplate>
                        <Grid>
                            <Path Data="M 0,16 L 16,0 L 16,16 Z" Fill="#CCCCCC"/>
                        </Grid>
                    </ControlTemplate>
                </Thumb.Template>
            </Thumb>
        </Grid>
    </Border>
</Window>